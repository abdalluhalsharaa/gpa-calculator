<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>حاسبة المعدّل</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f7fa;
    direction: rtl;
    text-align: center;
}

.container {
    max-width: 950px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}

h1 {
    margin-bottom: 5px;
}

h3 {
    margin-top: 4px;
    color: #555;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

th, td {
    border: 1px solid #ddd;
    padding: 8px;
}

select, input {
    padding: 6px;
    width: 100%;
}

button {
    padding: 6px 12px;
    cursor: pointer;
}

.excluded-row {
    background-color: #f0f0f0;
}

.excluded-row .subject-name {
    text-decoration: line-through;
    color: #888;
}

#result {
    white-space: pre-line;
    margin-top: 20px;
}
</style>
</head>

<body>

<div class="container">

<img src="logo.png" alt="شعار الجامعة" width="120">

<h1>حاسبة المُعدّل</h1>
<h3>جامعة البلقاء التطبيقية</h3>
<h3>كلية الطب - دفعة كوروناري</h3>

<hr>

<h3>المعدل السابق</h3>
<input type="number" id="prevGPA" step="0.0001" placeholder=" وإذا بدك تحسب معدل هذه السنة فقط فَـ ضع 0 ">

<h3>عدد الساعات السابقة</h3>
<input type="number" id="prevHours" placeholder=" وإذا بدك تحسب معدل هذه السنة فقط فَـ ضع 0 ">

<h3>اختر السنة</h3>
<select id="yearSelect" onchange="loadSubjects()">
    <option value="">-- اختر --</option>
    <option value="4">السنة الرابعة</option>
    <option value="5">السنة الخامسة</option>
    <option value="6">السنة السادسة</option>
</select>

<div id="subjects"></div>

<button onclick="calculateGPA()">احسب المعدل</button>

<h2 id="result"></h2>

</div>

<script>
// قيم الرموز
const gradeValues = {
    "A": 4,
    "A-": 3.75,
    "B+": 3.5,
    "B": 3.25,
    "B-": 3,
    "C+": 2.75,
    "C": 2.5,
    "C-": 2,
    "D+": 1.75,
    "D": 1.25,
    "D-": 1,
    "F": 0.5
};

// المواد حسب السنة
const subjectsData = {
    4: [
        ["التخدير والعناية الحثيثة", 3],
        ["جراحة العظام والمفاصل", 4],
        ["علوم عصبية سريرية", 3],
        ["رعاية صحية اولية", 3],
        ["باطنية ١", 10],
        ["جراحة عامة ١", 10]
    ],
    5: [
        ["الاشعة التشخيصية", 2],
        ["الامراض النسائية والتوليد ١", 8],
        ["امراض الانف والاذن والحنجرة", 2],
        ["امراض العيون", 2],
        ["امراض جلدية", 2],
        ["امراض نفسية", 4],
        ["جراحة المسالك البولية", 2],
        ["طب الاسرة", 4],
        ["طب الاطفال ١", 8],
        ["طب الطوارئ", 2],
        ["طب شرعي وسموم", 1],
        ["مقدمة في البحث السريري", 3],
        ["مقدمة في الطب السريري واخلاقيات مهنة الطب ٢", 2],
        ["نظم المعلومات الصحية ٢", 2]
    ],
    6: [
        ["الامراض النسائية والتوليد ٢", 8],
        ["باطنية ٢", 8],
        ["تدريب سريري في موضوع اختياري", 8],
        ["جراحة عامة ٢", 8],
        ["طب اطفال ٢", 8],
        ["مشروع تخرج", 6]
    ]
};

let excludedSubjects = [];

function loadSubjects() {
    excludedSubjects = [];
    const year = document.getElementById("yearSelect").value;
    const div = document.getElementById("subjects");
    div.innerHTML = "";

    if (!year) return;

    let table = `
    <table>
        <tr>
            <th>المادة</th>
            <th>الساعات</th>
            <th>الرمز</th>
            <th>استثناء</th>
        </tr>`;

    subjectsData[year].forEach(sub => {
        table += `
        <tr data-subject="${sub[0]}">
            <td class="subject-name">${sub[0]}</td>
            <td>${sub[1]}</td>
            <td>
                <select class="grade" data-hours="${sub[1]}">
                    <option value="">-- اختر --</option>
                    ${Object.keys(gradeValues)
                        .map(g => `<option value="${g}">${g}</option>`)
                        .join("")}
                </select>
            </td>
            <td>
                <button onclick="toggleExclude(this)">استثناء</button>
            </td>
        </tr>`;
    });

    table += "</table>";
    div.innerHTML = table;
        }

function toggleExclude(button) {
    const row = button.closest("tr");
    const subjectName = row.dataset.subject;
    const select = row.querySelector(".grade");

    if (row.classList.contains("excluded-row")) {
        row.classList.remove("excluded-row");
        select.disabled = false;
        excludedSubjects = excludedSubjects.filter(s => s !== subjectName);
        button.innerText = "استثناء";
    } else {
        row.classList.add("excluded-row");
        select.value = "";
        select.disabled = true;
        excludedSubjects.push(subjectName);
        button.innerText = "إلغاء";
    }
}

function calculateGPA() {
    const prevGPA = parseFloat(document.getElementById("prevGPA").value) || 0;
    const prevHours = parseFloat(document.getElementById("prevHours").value) || 0;

    let currentPoints = 0;
    let currentHours = 0;

    document.querySelectorAll(".grade").forEach(sel => {
        const row = sel.closest("tr");
        if (sel.value !== "" && !row.classList.contains("excluded-row")) {
            const hours = parseFloat(sel.dataset.hours);
            currentHours += hours;
            currentPoints += hours * gradeValues[sel.value];
        }
    });

    const totalHours = prevHours + currentHours;
    const totalPoints = (prevGPA * prevHours) + currentPoints;
    const newGPA = totalHours ? (totalPoints / totalHours).toFixed(4) : "0.0000";

    let output =
        "المعدل التراكمي الجديد : " + newGPA +
        "\nعدد الساعات التراكمية المحتسبة : " + totalHours;

    if (excludedSubjects.length > 0) {
        output += "\n\nباستثناء المادة / المواد :\n" + excludedSubjects.join(" ، ");
    }

    document.getElementById("result").innerText = output;
}
</script>

</body>
    </html>
